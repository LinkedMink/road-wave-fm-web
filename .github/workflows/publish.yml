name: Publish
concurrency: 
  group: publish
  cancel-in-progress: true
on:
  workflow_dispatch:
    inputs:
      uploadToTag:
        description: 'Upload built Bundle to Github tag'
        required: true
jobs:
  build:
    uses: LinkedMink/road-wave-fm-web/.github/workflows/build.yml@main
    with:
      uploadBuild: true
  publish:
    needs: [build]
    runs-on: ubuntu-latest
    steps:
    - name: Download App Bundle
      id: download
      uses: actions/download-artifact@v2
      with:
        name: app-bundle
    - name: Compress Artifacts
      run: tar -czvf road-wave-fm-web-${{ github.event.inputs.uploadToTag }}.tar.gz ${{steps.download.outputs.download-path}}
    - name: Upload Packages to Github
      uses: svenstaro/upload-release-action@v2
      with:
        repo_token: ${{ secrets.GITHUB_TOKEN }}
        file: road-wave-fm-web-${{ github.event.inputs.uploadToTag }}.tar.gz
        tag: ${{ github.event.inputs.uploadToTag }}
        overwrite: true
        file_glob: true
        prerelease: true
